import{g as B}from"./getPublicClient-0BHvZHD6.js";import{u as w}from"./useConfig-BkRNL90S.js";import{u as N}from"./useChainId-PVOZb_kK.js";import{W as t}from"./blast-BTKMzCxo.js";import{X as F,D as I,O as v}from"./vue-i18n-locales.generated-DazkPcQT.js";import{h as R}from"./index-CxlER5gv.js";const U=[{inputs:[],name:"slot0",outputs:[{internalType:"uint160",name:"sqrtPriceX96",type:"uint160"},{internalType:"int24",name:"tick",type:"int24"},{internalType:"uint16",name:"observationIndex",type:"uint16"},{internalType:"uint16",name:"observationCardinality",type:"uint16"},{internalType:"uint16",name:"observationCardinalityNext",type:"uint16"},{internalType:"uint8",name:"feeProtocol",type:"uint8"},{internalType:"bool",name:"unlocked",type:"bool"}],stateMutability:"view",type:"function"}],H=(i,a)=>{const n=B(w()),l=N(),e=F({currentPrice:0,priceInUsd:0,initialPrice:0,initialPriceUsd:0,preBondingProgress:0,bondingProgress:0,totalProgress:0,currentMarketCap:0,fullyDilutedMarketCap:0,isFinalized:!1,currentPhase:0,ethReserve:0n,tokenReserve:0n,totalPreBondingContributions:0n,totalETHCollected:0n,virtualEth:0n,preBondingTarget:0n,bondingTarget:0n,uniswapPool:null,update:async()=>{try{const s={isFinalized:[],currentPhase:[],ethReserve:[],tokenReserve:[],totalPreBondingContributions:[],totalETHCollected:[],getBondingCurveSettings:[],uniswapPool:[]},h=await n.multicall({contracts:Object.keys(s).map(r=>({address:i.contract,abi:i.factory.abi,functionName:r,args:s[r]}))}),[d,g,p,m,P,b,o,f]=h;if(d.status==="success"&&(e.isFinalized=d.result),g.status==="success"&&(e.currentPhase=g.result),p.status==="success"&&(e.ethReserve=p.result),m.status==="success"&&(e.tokenReserve=m.result),P.status==="success"&&(e.totalPreBondingContributions=P.result),b.status==="success"&&(e.totalETHCollected=b.result),o.status==="success"&&(e.virtualEth=o.result.virtualEth,e.preBondingTarget=o.result.preBondingTarget,e.bondingTarget=o.result.bondingTarget),f.status==="success"&&(e.uniswapPool=f.result),e.isFinalized&&e.uniswapPool)try{const c=(await n.readContract({address:e.uniswapPool,abi:U,functionName:"slot0"}))[0],u=BigInt(c)*BigInt(c)*BigInt(1e18)/2n**192n,k=await n.readContract({address:e.uniswapPool,abi:[{inputs:[],name:"token0",outputs:[{type:"address"}],stateMutability:"view",type:"function"}],functionName:"token0"}),T=await n.readContract({address:i.contract,abi:i.factory.abi,functionName:"getBondingCurveSettings"}),y=k.toLowerCase()===T.weth.toLowerCase();y?e.currentPrice=1/Number(t(u)):e.currentPrice=Number(t(u)),console.log({sqrtPriceX96:c.toString(),price:u.toString(),wethIsToken0:y,currentPrice:e.currentPrice})}catch(r){console.error("Error calculating Uniswap price:",r),e.ethReserve&&e.tokenReserve&&(e.currentPrice=Number(t(e.ethReserve))/Number(t(e.tokenReserve)))}else e.ethReserve&&e.tokenReserve&&(e.currentPrice=Number(t(e.ethReserve))/Number(t(e.tokenReserve)));e.priceInUsd=e.currentPrice*Number(a),e.virtualEth&&(e.initialPrice=Number(t(e.virtualEth))/1e9,e.initialPriceUsd=e.initialPrice*Number(a)),e.preBondingTarget&&(e.preBondingProgress=Number(t(e.totalPreBondingContributions))/Number(t(e.preBondingTarget))*100),e.bondingTarget&&(e.bondingProgress=Number(t(e.totalETHCollected))/Number(t(e.bondingTarget))*100),e.totalProgress=Math.min(100,Math.max(e.preBondingProgress,e.bondingProgress)),e.tokenReserve&&e.priceInUsd&&(e.currentMarketCap=Number(t(e.tokenReserve))*e.priceInUsd,e.fullyDilutedMarketCap=1e9*e.priceInUsd)}catch(s){console.error("Error updating price info:",s)}}}),C=I(()=>({currentPrice:e.currentPrice.toFixed(6),priceInUsd:e.priceInUsd.toFixed(6),initialPrice:e.initialPrice.toFixed(6),initialPriceUsd:e.initialPriceUsd.toFixed(6),preBondingProgress:Math.min(100,e.preBondingProgress).toFixed(2),bondingProgress:Math.min(100,e.bondingProgress).toFixed(2),totalProgress:Math.min(100,e.totalProgress).toFixed(2),currentMarketCap:e.currentMarketCap.toLocaleString("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:0}),fullyDilutedMarketCap:e.fullyDilutedMarketCap.toLocaleString("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:0})}));return v(l,()=>{l.value&&e.update()},{immediate:!0}),v(()=>R(a),()=>{e.update()},{immediate:!0}),{info:e,formatted:C}};export{H as u};
