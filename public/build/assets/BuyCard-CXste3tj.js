import{r as B,D as M,O as H,o as r,d as $,e as a,w as o,x as U,A as Y,f as h,U as X,u as l,B as O,l as P,y as ve,i as m,t as f,V as fe,Y as ye,$ as ge,F as xe,X as ke,T as Z}from"./vue-i18n-locales.generated-DazkPcQT.js";import{_ as p}from"./BaseButton-BhZf0EJx.js";import{_}from"./CollapseTransition-CDDa1-2u.js";import{L as he}from"./Loading-C3NjX0uh.js";import{u as re,_ as q,z as ee,c as be}from"./useContractCall-CIWWli1W.js";import{u as ie}from"./useAccount-CGBMXWeW.js";import{g as Ae}from"./getPublicClient-0BHvZHD6.js";import{u as $e}from"./useConfig-BkRNL90S.js";import{ad as te,p as D}from"./sepolia-CvxlrZeJ.js";import{p as ne,f as ae,W as T}from"./blast-BTKMzCxo.js";import{_ as F}from"./ChainSymbol-l-W0-0ND.js";import{_ as R}from"./FormInput-DeHhKyjW.js";import{p as E}from"./parseEther-f9fnxYOQ.js";import{a9 as we}from"./wagmi-CDY-DwX3.js";import{_ as se}from"./NetworkIcon-DeBWGLsL.js";import oe from"./ArrowLeftRight-Cw61_tm7.js";import{C as G}from"./cog-CTR64VRh.js";import{X as Ce}from"./x-CXg0Fv3A.js";import{V as Ie}from"./vault-C_wt6Mi_.js";import{C as Oe}from"./circle-check-big-CkHjRHQW.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./explorers-DVbKGEgl.js";import"./zora-DMUnMQki.js";import"./useChainId-PVOZb_kK.js";import"./index-CxlER5gv.js";import"./public-CBg5kwGr.js";import"./secp256k1-DxfVsibD.js";import"./plugin-DEBxRKPP.js";import"./createLucideIcon-C3-ZXal3.js";const ze={__name:"ApproveTokenButton",props:{contract:{type:String,required:!0},spender:{type:String,required:!0},amount:{type:BigInt,default:0n},shouldApprove:{type:Boolean,default:!0}},emits:["approve"],setup(i,{emit:I}){const y=i,x=I,{address:s}=ie(),d=Ae($e()),b=B(0),A=B(!1),g=u=>x("approve",u),c=async()=>{A.value=!0,b.value=await d.readContract({address:y.contract,abi:te,functionName:"allowance",args:[s.value,y.spender]}),A.value=!1},w=M(()=>y.contract),k=re(te,w);k.status="Approve tokens to deposit";const z=async()=>{await k.call("approve",[y.spender,y.amount]),await c(),g(k.receipt)},L=M(()=>y.contract!==ee&&y.shouldApprove&&b.value<y.amount);return H([()=>y.shouldApprove,()=>y.contract,()=>y.spender],([u,V,j,J])=>{!u||!ne(V)||!ne(j)||V===ee||c()},{immediate:!0}),(u,V)=>(r(),$(xe,null,[a(_,null,{default:o(()=>[U(h("div",fe({class:"relative mt-6 flex gap-3"},u.$attrs),[X(u.$slots,"approval",{state:l(k),approve:z},()=>[l(k).called==="approve"?(r(),O(q,{key:0,state:l(k)},null,8,["state"])):P("",!0),a(p,{disabled:l(k).busy||l(k).confirming,class:"w-full",outlined:"",onClick:ve(z,["prevent"])},{default:o(()=>[X(u.$slots,"button",{},()=>[l(k).busy||l(k).confirming?(r(),O(he,{key:0,class:"-ml-1 !mr-2 inline-flex"})):P("",!0),m(" "+f(u.$t("Approve Tokens")),1)])]),_:3},8,["disabled"])])],16),[[Y,L.value]])]),_:3}),a(_,null,{default:o(()=>[U(h("div",ye(ge(u.$attrs)),[X(u.$slots,"default")],16),[[Y,!L.value]])]),_:3})],64))}},le=(i,I,y,x,s=18)=>{try{const d=E(y);if(i<=0n||I<=0n||d<=0n||x<0)return{expectedOutputAmount:0,minimumOutputAmount:0,expectedOutputAmountWei:0,minimumOutputAmountWei:0,priceImpact:"0%"};const b=i*I,A=i+d,g=b/A,c=I-g,w=100n-BigInt(x),k=c*w/100n,z=Number(d*10000n/i)/100;return{expectedOutputAmount:parseFloat(ae(c,s)).toFixed(),minimumOutputAmount:ae(k,s),expectedOutputAmountWei:c.toString(),minimumOutputAmountWei:k.toString(),priceImpact:z.toFixed(2)+"%"}}catch(d){throw new Error(`Calculation error: ${d.message}`)}},ue=(i,I,y,x,s=18)=>{try{const d=we(y,s);if(i<=0n||I<=0n||d<=0n||x<0)return{expectedOutputAmount:0,minimumOutputAmount:0,expectedOutputAmountWei:0,minimumOutputAmountWei:0,priceImpact:"0%"};const b=i*I,A=I+d,g=b/A,c=i-g,w=100n-BigInt(x),k=c*w/100n,z=Number(d*10000n/I)/100;return{expectedOutputAmount:T(c),minimumOutputAmount:T(k),expectedOutputAmountWei:c.toString(),minimumOutputAmountWei:k.toString(),priceImpact:z.toFixed(2)+"%"}}catch(d){throw new Error(`Calculation error: ${d.message}`)}},Pe={class:"w-full grid gap-4"},Se={key:0,class:"bg-gray-800 p-4 rounded-lg border border-none text-gray-400 grid gap-4"},We={class:"grid grid-cols-2 gap-2 mb-2"},Be={key:1,class:"text-xl font-extralight ml-4"},Te={class:"flex flex-col"},Fe={key:0,class:"flex items-center gap-2 ml-2"},Ve=["src"],Le={key:1,class:"flex items-center gap-2 ml-2"},Ee={class:"flex items-center gap-2 ml-2"},Me={key:0,class:"flex items-center gap-2 ml-2"},Ne=["src"],qe={key:1,class:"flex items-center gap-2 ml-2"},Ue={class:"flex items-center gap-2 ml-2"},Ye={key:2,class:"flex items-center gap-1 mt-2 bg-gray-800 p-1 rounded-lg"},je={key:3,class:"flex items-center gap-1 mt-2 bg-gray-800 p-1 rounded-lg"},Xe={class:"flex flex-col"},De={class:"text-xs text-primary font-semibold ml-0.5"},Re={class:"flex items-center gap-2 ml-2"},Ge={class:"flex items-center gap-1 mt-2 bg-gray-800 p-1 rounded-lg"},He={class:"flex flex-col gap-2"},Je={class:"text-xs"},Ke={key:0},Qe={key:0},Ze={key:1},_e={key:1},et={key:0},tt={key:1},nt={key:1,class:"bg-gray-800 p-4 text-center rounded-lg border border-none text-gray-400 grid gap-4"},at={class:"text-lg font-medium flex justify-center items-center"},st={class:"font-extralight !text-primary"},ot={key:2,class:"p-4 text-center rounded-lg border border-gray-800 text-gray-400 grid gap-4"},lt={key:3,class:"p-4 text-center bg-emerald-800/10 rounded-lg border border-emerald-800 text-gray-400 grid gap-4"},ut={class:"font-extralight !text-emerald-500 flex justify-center items-center"},rt=["href"],Mt={__name:"BuyCard",props:{launchpad:Object},setup(i){const I=B(!1),y=i,x=B("buy"),s=be(y.launchpad),d=re(y.launchpad.factory.abi,y.launchpad.contract),b=B(!1),A=B(5),g=B(.1),c=B(0),w=ke({expectedOutputAmount:0,minimumOutputAmount:0,expectedOutputAmountWei:0,minimumOutputAmountWei:0,priceImpact:"0%"}),k=M(()=>s.currentPhase===0?s.virtualEth:s.ethReserve),z=M(()=>s.currentPhase===0?s.tokenBalance:s.tokenReserve);H([g,k,z,A],([t,e,n,C])=>{if(b.value)return;if(parseFloat(t)===0){c.value="0";return}const v=le(e,n,`${t}`,C);c.value=v.expectedOutputAmount,w.expectedOutputAmount=v.expectedOutputAmount,w.expectedOutputAmountWei=v.expectedOutputAmountWei,w.minimumOutputAmount=v.minimumOutputAmount,w.minimumOutputAmountWei=v.minimumOutputAmountWei,w.priceImpact=v.priceImpact}),H([c,k,z,A],([t,e,n,C])=>{if(!b.value)return;const v=ue(e,n,`${t}`,C);g.value=v.expectedOutputAmount,w.expectedOutputAmount=v.expectedOutputAmount,w.expectedOutputAmountWei=v.expectedOutputAmountWei,w.minimumOutputAmount=v.minimumOutputAmount,w.minimumOutputAmountWei=v.minimumOutputAmountWei,w.priceImpact=v.priceImpact});const{address:L}=ie(),u=Z({launchpad_id:y.launchpad.id,address:L.value,qty:c.value,amount:g.value,txid:null,type:s.currentPhase===0?"prebond":x.value}),V=t=>{x.value=t,b.value=t==="sell"},j=t=>{u.txid=t,u.qty=c.value,u.amount=g.value,u.type=s.currentPhase===0?"prebond":x.value,u.post(window.route("trades.store"),{preserveState:!0,preserveScroll:!0})},J=()=>{var e,n,C,v,S,W;const t=D({abi:y.launchpad.factory.abi,logs:d.receipt.logs,eventName:["PreBondingContribution"]});u.txid=d.txhash,u.type=s.currentPhase===0?"prebond":x.value,u.qty=T((n=(e=t==null?void 0:t[0])==null?void 0:e.args)==null?void 0:n.tokenAmount),u.amount=T((v=(C=t==null?void 0:t[0])==null?void 0:C.args)==null?void 0:v.amount),u.address=(W=(S=t==null?void 0:t[0])==null?void 0:S.args)==null?void 0:W.contributor,u.post(window.route("trades.store"),{preserveState:!0,preserveScroll:!0})},de=()=>{var e,n,C,v,S,W;const t=D({abi:y.launchpad.factory.abi,logs:d.receipt.logs,eventName:["TokensPurchased"]});u.txid=d.txhash,u.type=s.currentPhase===0?"prebond":x.value,console.log(t),u.qty=T((n=(e=t==null?void 0:t[0])==null?void 0:e.args)==null?void 0:n.tokenAmount),u.amount=T((v=(C=t==null?void 0:t[0])==null?void 0:C.args)==null?void 0:v.ethAmount),u.address=(W=(S=t==null?void 0:t[0])==null?void 0:S.args)==null?void 0:W.buyer,u.post(window.route("trades.store"),{preserveState:!0,preserveScroll:!0})},me=()=>{var e,n,C,v,S,W;const t=D({abi:y.launchpad.factory.abi,logs:d.receipt.logs,eventName:["TokensSold"]});u.txid=d.txhash,u.qty=T((n=(e=t==null?void 0:t[0])==null?void 0:e.args)==null?void 0:n.tokenAmount),u.amount=T((v=(C=t==null?void 0:t[0])==null?void 0:C.args)==null?void 0:v.ethAmount),u.address=(W=(S=t==null?void 0:t[0])==null?void 0:S.args)==null?void 0:W.seller,u.post(window.route("trades.store"),{preserveState:!0,preserveScroll:!0})},K=async()=>{let t,e,n,C;if(s.currentPhase===0&&(t="contributePreBonding",C=J,n=E(`${g.value}`),e=[]),s.currentPhase===1){if(x.value==="buy"){t="buyTokens",n=E(`${g.value}`),C=de;const v=le(k.value,z.value,`${g.value}`,A.value);console.log(v),e=[v.minimumOutputAmountWei]}if(x.value==="sell"){t="sellTokens";const v=E(`${c.value}`);n=0,C=me;const S=ue(k.value,z.value,`${c.value}`,A.value);e=[v,S.minimumOutputAmountWei]}}s.currentPhase!==2&&(await d.call(t,e,n,j),!d.error&&(C(),s.updateInfo()))},pe=async()=>{await d.call("withdrawTokenAllocation",[L.value],0,null),s.updateInfo()},Q=Z({pool:null}),ce=async()=>{await d.call("finalizeCurve",[]),await s.updateInfo(),Q.pool=s.uniswapPool,Q.put(window.route("launchpads.finalize",{launchpad:y.launchpad.id}),{preserveScroll:!0,preserveState:!0})},N=M(()=>{const t=s.preBondingTarget-s.totalPreBondingContributions;return g.value>t?t:null});return(t,e)=>(r(),$("div",Pe,[l(s).currentPhase<2?(r(),$("div",Se,[h("div",We,[a(p,{onClick:e[0]||(e[0]=n=>V("buy")),size:"xs",secondary:x.value!="buy"},{default:o(()=>[m(f(t.$t("BUY")),1)]),_:1},8,["secondary"]),l(s).currentPhase==1?(r(),O(p,{key:0,onClick:e[1]||(e[1]=n=>V("sell")),size:"xs",danger:x.value=="sell",secondary:x.value!="sell"},{default:o(()=>[m(f(t.$t("SELL")),1)]),_:1},8,["danger","secondary"])):P("",!0),l(s).currentPhase==0?(r(),$("h3",Be,f(t.$t("Prebond")),1)):P("",!0)]),U(h("div",Te,[b.value?(r(),O(R,{key:0,size:"sm",modelValue:c.value,"onUpdate:modelValue":e[4]||(e[4]=n=>c.value=n),"input-classes":"!pl-24"},{lead:o(()=>[b.value?(r(),$("div",Fe,[h("img",{class:"w-4 h-4 rounded-full",src:i.launchpad.logo,loading:"lazy"},null,8,Ve),m(" "+f(i.launchpad.symbol),1)])):(r(),$("div",Le,[a(se,{chainId:i.launchpad.chainId,class:"w-4 h-4 rounded-full"},null,8,["chainId"]),a(F,{chainId:i.launchpad.chainId},null,8,["chainId"])]))]),trail:o(()=>[h("div",Ee,[a(p,{onClick:e[2]||(e[2]=n=>b.value=!b.value),size:"xss",iconMode:"",secondary:""},{default:o(()=>[a(oe,{class:"w-4 h-4"})]),_:1}),a(p,{onClick:e[3]||(e[3]=n=>I.value=!0),size:"xss",iconMode:"",secondary:""},{default:o(()=>[a(l(G),{class:"w-4 h-4"})]),_:1})])]),_:1},8,["modelValue"])):(r(),O(R,{key:1,size:"sm",modelValue:g.value,"onUpdate:modelValue":e[8]||(e[8]=n=>g.value=n),error:N.value?`Max is ${N.value}`:"","input-classes":"!pl-24"},{lead:o(()=>[b.value?(r(),$("div",Me,[h("img",{class:"w-4 h-4 rounded-full",src:i.launchpad.logo,loading:"lazy"},null,8,Ne),m(" "+f(i.launchpad.symbol),1)])):(r(),$("div",qe,[a(se,{chainId:i.launchpad.chainId,class:"w-4 h-4 rounded-full"},null,8,["chainId"]),a(F,{chainId:i.launchpad.chainId},null,8,["chainId"])]))]),trail:o(()=>[h("div",Ue,[N.value?(r(),O(p,{key:0,onClick:e[5]||(e[5]=n=>g.value=N.value),size:"xss",secondary:""},{default:o(()=>e[28]||(e[28]=[m(" MAX ")])),_:1})):(r(),O(p,{key:1,onClick:e[6]||(e[6]=n=>b.value=!b.value),size:"xss",iconMode:"",secondary:""},{default:o(()=>[a(oe,{class:"w-4 h-4"})]),_:1})),a(p,{onClick:e[7]||(e[7]=n=>I.value=!0),size:"xss",iconMode:"",secondary:""},{default:o(()=>[a(l(G),{class:"w-4 h-4"})]),_:1})])]),_:1},8,["modelValue","error"])),b.value&&x.value==="sell"?(r(),$("div",Ye,[a(p,{onClick:e[9]||(e[9]=n=>c.value=0),size:"xss",outlined:"","icon-mode":"",secondary:""},{default:o(()=>[a(l(Ce),{class:"w-4 h-4 hover:rotate-90 hover:text-red-500 transition-all duration-300"})]),_:1}),a(p,{onClick:e[10]||(e[10]=n=>c.value=l(s).balance),size:"xss",secondary:""},{default:o(()=>e[29]||(e[29]=[m(" BAL ")])),_:1}),a(p,{onClick:e[11]||(e[11]=n=>c.value=l(s).balance*.1),size:"xss",secondary:""},{default:o(()=>e[30]||(e[30]=[m(" 10% ")])),_:1}),a(p,{onClick:e[12]||(e[12]=n=>c.value=l(s).balance*.25),size:"xss",secondary:""},{default:o(()=>e[31]||(e[31]=[m(" 25% ")])),_:1}),a(p,{onClick:e[13]||(e[13]=n=>c.value=l(s).balance*.5),size:"xss",secondary:""},{default:o(()=>e[32]||(e[32]=[m(" 50% ")])),_:1}),a(p,{onClick:e[14]||(e[14]=n=>c.value=l(s).balance*.75),size:"xss",secondary:""},{default:o(()=>e[33]||(e[33]=[m(" 75% ")])),_:1})])):(r(),$("div",je,[a(p,{onClick:e[15]||(e[15]=n=>g.value=0),size:"xss",outlined:"",secondary:""},{default:o(()=>[m(f(t.$t("RESET")),1)]),_:1}),a(p,{onClick:e[16]||(e[16]=n=>g.value=.1),size:"xss",secondary:""},{default:o(()=>[e[34]||(e[34]=m(" 0.1 ")),a(F,{class:"ml-1",chainId:i.launchpad.chainId},null,8,["chainId"])]),_:1}),a(p,{onClick:e[17]||(e[17]=n=>g.value=.5),size:"xss",secondary:""},{default:o(()=>[e[35]||(e[35]=m(" 0.5 ")),a(F,{class:"ml-1",chainId:i.launchpad.chainId},null,8,["chainId"])]),_:1}),a(p,{onClick:e[18]||(e[18]=n=>g.value=1),size:"xss",secondary:""},{default:o(()=>[e[36]||(e[36]=m(" 1 ")),a(F,{class:"ml-1",chainId:i.launchpad.chainId},null,8,["chainId"])]),_:1}),a(p,{onClick:e[19]||(e[19]=n=>g.value=3),size:"xss",secondary:""},{default:o(()=>[e[37]||(e[37]=m(" 3 ")),a(F,{class:"ml-1",chainId:i.launchpad.chainId},null,8,["chainId"])]),_:1})]))],512),[[Y,!I.value]]),U(h("div",Xe,[a(R,{modelValue:A.value,"onUpdate:modelValue":e[21]||(e[21]=n=>A.value=n),size:"sm","input-classes":"!pl-24"},{lead:o(()=>[h("span",De,f(t.$t("SLIPPAGE"))+" % ",1)]),trail:o(()=>[h("div",Re,[a(p,{onClick:e[20]||(e[20]=n=>I.value=!1),size:"xss",iconMode:"",primary:""},{default:o(()=>[a(l(G),{class:"w-4 h-4"})]),_:1})])]),_:1},8,["modelValue"]),h("div",Ge,[a(p,{onClick:e[22]||(e[22]=n=>A.value=5),size:"xss",outlined:"",secondary:""},{default:o(()=>e[38]||(e[38]=[m(" 5% ")])),_:1}),a(p,{onClick:e[23]||(e[23]=n=>A.value=10),size:"xss",outlined:"",secondary:""},{default:o(()=>e[39]||(e[39]=[m(" 10% ")])),_:1}),a(p,{onClick:e[24]||(e[24]=n=>A.value=15),size:"xss",outlined:"",secondary:""},{default:o(()=>e[40]||(e[40]=[m(" 15% ")])),_:1}),a(p,{onClick:e[25]||(e[25]=n=>A.value=20),size:"xss",outlined:"",secondary:""},{default:o(()=>e[41]||(e[41]=[m(" 20% ")])),_:1}),a(p,{onClick:e[26]||(e[26]=n=>A.value=25),size:"xss",outlined:"",secondary:""},{default:o(()=>e[42]||(e[42]=[m(" 25% ")])),_:1}),a(p,{onClick:e[27]||(e[27]=n=>A.value=30),size:"xss",outlined:"",secondary:""},{default:o(()=>e[43]||(e[43]=[m(" 30% ")])),_:1})])],512),[[Y,I.value]]),h("div",He,[["sellTokens","buyTokens","contributePreBonding"].includes(l(d).called)?(r(),O(q,{key:0,class:"mb-2",state:l(d)},null,8,["state"])):P("",!0),x.value=="sell"?(r(),O(ze,{key:1,class:"flex-col",contract:i.launchpad.token,spender:i.launchpad.contract,amount:l(E)(`${c.value}`),shouldApprove:""},{default:o(()=>[a(p,{class:"w-full",onClick:K,danger:""},{default:o(()=>[m(f(t.$t("Place trade")),1)]),_:1})]),_:1},8,["contract","spender","amount"])):(r(),O(p,{key:2,onClick:K},{default:o(()=>[m(f(t.$t("Place trade")),1)]),_:1}))]),h("div",Je,[b.value?(r(),$("div",Ke,[x.value==="sell"?(r(),$("span",Qe,f(t.$t("You receive min.")),1)):(r(),$("span",Ze,f(t.$t("You spend min.")),1)),h("b",null,f(parseFloat(g.value).toFixed(8)),1),a(F,{class:"ml-1",chainId:i.launchpad.chainId},null,8,["chainId"]),m(" (- "+f(w.priceImpact)+" impact) ",1)])):(r(),$("div",_e,[x.value==="buy"?(r(),$("span",et,f(t.$t("You receive min.")),1)):(r(),$("span",tt,f(t.$t("You spend min.")),1)),h("b",null,f(parseFloat(c.value).toFixed()),1),m(" "+f(i.launchpad.symbol)+" (- "+f(w.priceImpact)+" impact) ",1)]))])])):P("",!0),l(s).contributions>0&&l(s).tokenLocks?(r(),$("div",nt,[h("h3",at,[a(l(Ie),{class:"w-5 h-5 mr-2 inline-flex"}),m(" "+f(t.$t("Prebond Purchase")),1)]),h("h3",st,f(parseFloat(l(s).tokenAllocations).toFixed())+" "+f(i.launchpad.symbol),1),l(d).called==="withdrawTokenAllocation"?(r(),O(q,{key:0,state:l(d)},null,8,["state"])):P("",!0),a(p,{secondary:"",outlined:"",onClick:pe},{default:o(()=>[m(f(t.$t("Withdraw Prebond Allocation")),1)]),_:1})])):P("",!0),l(s).currentPhase===2&&!l(s).isFinalized?(r(),$("div",ot,[l(d).called==="finalizeCurve"?(r(),O(q,{key:0,state:l(d)},null,8,["state"])):P("",!0),a(p,{primary:"",outlined:"",onClick:ce},{default:o(()=>[m(f(t.$t("Finalize Launchpad")),1)]),_:1})])):P("",!0),l(s).isFinalized?(r(),$("div",lt,[h("h3",ut,[a(l(Oe),{class:"w-7 h-7 mr-2 inline-flex"}),m(" "+f(t.$t("Launchpad Finalized")),1)]),h("a",{class:"text-emerald-100 hover:text-emerald-200",ref:"nofollow",target:"_blank",href:`https://app.uniswap.org/swap?inputCurrency=${i.launchpad.token}`},f(t.$t("Swap on Uniswap")),9,rt)])):P("",!0)]))}};export{Mt as default};
